---
title: 3.2 前端的数据接口
---

# 前端的数据接口

在了解，知道并体验了后端的分层架构之后，可不可以将这种分层架构的思想应用在前端上呢？答案当然是肯定的。这次我们主要的工作就是将后端的接口封装成前端使用的模块和方法，将数据的获取从数据的处理抽离出来。

## 在哪里

在一个微信小程序中，我们应该将分离出来的接口文件放在哪里呢？微信官方并没有推荐这样一个目录，但是通常情况下我们都会将这类文件放在`utils`(模板工具类)文件夹下。

    wechatmini/
        - utils/
            wechat.js*
            ...
        ...

## 怎么写

由于后端使用了基于cookie的session来进行状态管理，也就是Cookie中的session字段是区分不同用户的关键。但是微信的`wx.request`并不会像浏览器一样去维护你的cookie，所以就需要我们自己实现一个封装一个`request`来保存session。

```js
    // utils/wechat.js
    class Wechat {
        /**
         * 发起网络请求
         * @param {string} url  
         * @param {object} params 
         * @return {Promise} 
         */
        static request(url, params, method = "GET", type = "json") {
            console.info("向后端传递的参数", params);
            return new Promise((resolve, reject) => {
                if (this.cookie == null) {
                    this.cookie = wx.getStorageSync("sessionid");
                }
                let header = {
                    'Content-Type': type
                }
                if (this.cookie != "") {
                    header["Cookie"] = this.cookie;
                }
                let flashCookie = data => {
                    console.info("后端返回的信息", data);
                    let cookie = data.header["Set-Cookie"];
                    if (cookie) {
                    wx.setStorageSync("sessionid", cookie.split(";")[0]);
                    this.cookie = cookie;
                    }
                    return resolve(data);
                };
                let opts = {
                    url: url,
                    data: Object.assign({}, params),
                    method: method,
                    header: header,
                    success: flashCookie,
                    fail: reject
                }
                console.info("请求的URL", opts.url);
                wx.request(opts);
            });
        });
    }
    module.exports = Wechat;
```

这样子，我们就使用`Promise`封装了`wx.request`。

为了实例方便，我们就是顺手将我们后端的请求也封装在这个类中。(具体实现参考这个文件内的代码)。

