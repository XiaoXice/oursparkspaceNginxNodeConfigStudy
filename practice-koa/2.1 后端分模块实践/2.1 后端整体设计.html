<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.1 后端整体设计 | 平台开发文档</title>
    <meta name="description" content="为了更好的开发">
    <script type="text/javascript" src="https://s96.cnzz.com/z_stat.php?id=1276670037&amp;web_id=1276670037"></script>
    
    <link rel="preload" href="/oursparkspaceNginxNodeConfigStudy/assets/css/0.styles.3c3bcc60.css" as="style"><link rel="preload" href="/oursparkspaceNginxNodeConfigStudy/assets/js/app.fa70d2ae.js" as="script"><link rel="preload" href="/oursparkspaceNginxNodeConfigStudy/assets/js/28.da5d0cfe.js" as="script"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/10.681ecf30.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/11.271da7e0.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/12.a58c2c56.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/13.f9f6f205.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/14.bfc83ea4.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/15.b52eb4d1.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/16.022d542d.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/17.4489aa77.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/18.370a1b3a.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/19.0bd99501.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/2.7e54c8c4.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/20.e5f3565c.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/21.c46405c7.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/22.c07155e9.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/23.1fcd985e.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/24.dea88fe5.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/25.ac9a030b.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/26.a9450606.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/27.be4f713b.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/29.6243f02e.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/3.992ff33a.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/30.20d154a6.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/31.c2f0a0f7.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/32.4e54a1bf.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/33.f2b3d619.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/34.5badc128.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/35.ed762a5b.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/4.11cb110e.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/5.5753e940.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/6.e76a401f.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/7.9cc00c44.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/8.01b35c84.js"><link rel="prefetch" href="/oursparkspaceNginxNodeConfigStudy/assets/js/9.d28ea21d.js">
    <link rel="stylesheet" href="/oursparkspaceNginxNodeConfigStudy/assets/css/0.styles.3c3bcc60.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/oursparkspaceNginxNodeConfigStudy/" class="home-link router-link-active"><!----> <span class="site-name">平台开发文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/" class="nav-link">主页</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/Basic/" class="nav-link">基础知识</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/" class="nav-link router-link-active">后端实践-koa</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/practice-express/" class="nav-link">后端实践-express</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/front/" class="nav-link">微信小程序前端</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/deploy/" class="nav-link">代码部署</a></div> <a href="https://github.com/XiaoXice/oursparkspaceNginxNodeConfigStudy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/" class="nav-link">主页</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/Basic/" class="nav-link">基础知识</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/" class="nav-link router-link-active">后端实践-koa</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/practice-express/" class="nav-link">后端实践-express</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/front/" class="nav-link">微信小程序前端</a></div><div class="nav-item"><a href="/oursparkspaceNginxNodeConfigStudy/deploy/" class="nav-link">代码部署</a></div> <a href="https://github.com/XiaoXice/oursparkspaceNginxNodeConfigStudy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>2.1 后端分模块实践</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1 后端整体设计.html" class="active sidebar-link">2.1 后端整体设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1 后端整体设计.html#我们需要干什么？" class="sidebar-link">我们需要干什么？</a></li><li class="sidebar-sub-header"><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1 后端整体设计.html#接口设计" class="sidebar-link">接口设计</a></li><li class="sidebar-sub-header"><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1 后端整体设计.html#数据库结构设计" class="sidebar-link">数据库结构设计</a></li></ul></li><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1.1 Mongoose 实战.html" class="sidebar-link">2.1.1 Mongoose 实战</a></li><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.1 后端分模块实践/2.1.2 Koa 实战.html" class="sidebar-link">2.1.2 Koa实战</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>2.2 后端架构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.2 后端架构/2.2.1 Koa抬手式.html" class="sidebar-link">2.2.1 Koa 抬手式</a></li><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.2 后端架构/2.2.2 Mongoose静态方法构建.html" class="sidebar-link">2.2.2 Mongoose静态方法构建</a></li><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.2 后端架构/2.2.3 Koa路由和业务逻辑.html" class="sidebar-link">2.2.3 Koa路由和业务逻辑</a></li><li><a href="/oursparkspaceNginxNodeConfigStudy/practice-koa/2.2 后端架构/2.2.4 开发调试.html" class="sidebar-link">2.2.4 开发调试</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="后端整体设计"><a href="#后端整体设计" aria-hidden="true" class="header-anchor">#</a> 后端整体设计</h1> <p>“分层设计”是任何程序在开始开发之前要做的事情，没有经过分层设计的程序到最后基本都是不可维护的。这一节我们就将所需要的后台分割成几个小模块，加个大问题分解成小问题。</p> <h2 id="我们需要干什么？"><a href="#我们需要干什么？" aria-hidden="true" class="header-anchor">#</a> 我们需要干什么？</h2> <p>按照需求导向型，我们需要知道自己写的代码需要干什么？</p> <h2 id="接口设计"><a href="#接口设计" aria-hidden="true" class="header-anchor">#</a> 接口设计</h2> <p>毫无疑问，作为微信小程序的后台，它要做的最重要的事情就是完成前端提交的各种请求，前端和后端之间的沟通使用则是HTTP协议，很显然，后端提供的服务有很多，并不是一个接口可以解决的，区分不同接口的则是<code>URL</code>Uniform Resource Locator，统一资源定位符，也就是我们常说的网址或者路径。不同的路径指向不同的网页/资源/接口，相同的路径则指向相同的东西。URL通常是使用<code>/</code>作为分隔符，一级一级的结构。</p> <p>现在轮到我们自己来定义自己接口的URL，这时候我们就需要<strong>接口设计</strong>。</p> <p>作为一个前后端分离的程序，常见的后端API设计是采用<code>RESTful</code>接口设计风格。</p> <p>REST，即Representational State Transfer的缩写。</p> <p>我们总结一下什么是RESTful架构：</p> <ol><li>每一个URI代表一种资源；</li> <li>客户端和服务器之间，传递这种资源的某种表现层；</li> <li>客户端通过四个HTTP动词，对服务器端资源进行操作，实现&quot;表现层状态转化&quot;。</li></ol> <p>具体的规则可以参考这个网页<a href="https://www.jianshu.com/p/8b769356ee67" target="_blank" rel="noopener noreferrer">restful接口设计规范总结<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>回顾一下第一章的内容，我们的资源有下面几个：</p> <ol><li>用户</li> <li>留言</li> <li>留言的评论</li></ol> <p>我们需要的功能有：</p> <ol><li>用户的登录和状态检查</li> <li>留言的创建和获取</li> <li>评论的创建和获取</li> <li>喜欢的点赞和获取</li></ol> <p>因此对应接口的列表也就可以可以出现了</p> <ul><li>POST /login 使用微信接口登录</li> <li>GET /user/:id 获取该用户相关信息</li> <li>POST /message 创建一个新的留言</li> <li>GET /message 获取留言列表</li> <li>DELETE /message/:id 删除一个留言</li> <li>PATCH /message/:id 更新留言内容</li> <li>GET /message/:id/comment 获取某个留言的评论列表</li> <li>POST /message/:id/comment 提交一个评论</li> <li>GET /message/:id/comment/:id 获取某个留言的评论的相关信息</li> <li>DELETE /message/:id/comment/:id 删除一个评论</li> <li>PATCH /message/:id/comment/:id 更新评论内容</li> <li>POST /message/:id/like 给留言喜欢</li> <li>DELETE /message/:id/like 取消留言的喜欢</li></ul> <p>然后就是给每个接口调用需要传递的参数进行规定，这方面的事情应该就可以水到渠成了。等我们具体的进行接口实现的时候在加考虑，如果你认为自己独立设计这么一套接口有些困难，这是正常现象，毕竟很多人都是第一次考虑这么后端的事情，平时在网页上点点点，应该也不会注意背后的运行机制，有兴趣的同学可以去Github的API列表学习一下它的设计思路，平时在使用网站/APP/微信小程序的时候也可以把自己当作设计师，想一下如果是让我们自己设计，应该如何设计。</p> <h2 id="数据库结构设计"><a href="#数据库结构设计" aria-hidden="true" class="header-anchor">#</a> 数据库结构设计</h2> <p>再次回顾我们的资源：</p> <ol><li>用户</li> <li>留言</li> <li>留言的评论</li></ol> <p>根据MongoDB的NoSQL特性，我们这样设计三个集合和他们的结构：</p> <ul><li><p>user</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    _id<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>            <span class="token comment">// MongoDB自动生成的唯一标识</span>
    openID<span class="token punctuation">:</span> String<span class="token punctuation">,</span>           <span class="token comment">// 微信小程序的统一用户ID</span>
    sessionKey<span class="token punctuation">:</span> String<span class="token punctuation">,</span>       <span class="token comment">// 用来和 微信小程序校验信息的 东西</span>
    nickName<span class="token punctuation">:</span> String<span class="token punctuation">,</span>         <span class="token comment">// 用户昵称</span>
    avatarUrl<span class="token punctuation">:</span> String<span class="token punctuation">,</span>        <span class="token comment">// 用户头像地址</span>
    messgaeList<span class="token punctuation">:</span> <span class="token punctuation">[</span>ObjectID<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 这个用户的所有留言的_id组成的数组</span>
    commitLIst<span class="token punctuation">:</span> <span class="token punctuation">[</span>ObjectID<span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 这个用户所有评论_id组成的数组</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>message</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    _id<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>            <span class="token comment">// MongoDB 自动生成的唯一标识</span>
    author<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>         <span class="token comment">// 这篇留言的作者</span>
    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>          <span class="token comment">// 这篇留言的内容</span>
    like<span class="token punctuation">:</span> <span class="token punctuation">[</span>ObjectID<span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token comment">// 点赞的人</span>
    commitList<span class="token punctuation">:</span> <span class="token punctuation">[</span>ObjectID<span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 评论列表</span>
    creationTime<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>       <span class="token comment">// 创建时间</span>
    updateTime<span class="token punctuation">:</span> Date          <span class="token comment">// 更新时间</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>commit</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    _id<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>            <span class="token comment">// MongoDB 自动生成的统一ID</span>
    author<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>         <span class="token comment">// 这篇评论的作者</span>
    message<span class="token punctuation">:</span> ObjectID<span class="token punctuation">,</span>        <span class="token comment">// 这篇评论所处的留言</span>
    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>          <span class="token comment">// 这篇评论的内容</span>
    followList<span class="token punctuation">:</span> <span class="token punctuation">[</span>ObjectID<span class="token punctuation">]</span>    <span class="token comment">// 回复这篇评论的评论(这个特性太难了，各位可以想想怎么实现，暂时用不到)</span>
    creationTime<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>       <span class="token comment">// 创建时间</span>
    updateTime<span class="token punctuation">:</span> Date          <span class="token comment">// 更新时间</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>到此为止，我们后端的总体设计就完成了，下面我们就开始构建我们的后端程序。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/XiaoXice/oursparkspaceNginxNodeConfigStudy/edit/doc/practice-koa/2.1 后端分模块实践/2.1 后端整体设计.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/oursparkspaceNginxNodeConfigStudy/assets/js/app.fa70d2ae.js" defer></script><script src="/oursparkspaceNginxNodeConfigStudy/assets/js/28.da5d0cfe.js" defer></script>
  </body>
</html>
